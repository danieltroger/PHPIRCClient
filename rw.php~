<?php
error_reporting(0); //disable dirty error messages in the chatt
date_default_timezone_set("Europe/Stockholm"); //set europe timezone
set_time_limit(0);//ehhh idk y
$server = "irc.freenode.org"; // nah the server to connect to
$channels = "#goeosbottest"; // it should be channel, atm only one channel is supported
$port = 6667; // default irc port
$nick = "dan|el"; //nah the nick
$connection = fsockopen("$server", $port); //open a socket

fputs ($connection, "USER $nick $nick $nick $nick :$nick\n");//connect as a user
fputs ($connection, "NICK $nick\n"); //set a nick
fputs ($connection, "JOIN {$channels}\n"); // and join the channel
$handle = fopen ("php://stdin","r"); // open stdin as resource
stream_set_blocking($handle,0); // turn streamblocking off, that we can check both resources in one loop
stream_set_blocking($connection,0); //for both resources
//echo "->  ";
while(1) //the while loop that runs eaech 50ms
{
$data = fgets($connection); // 
if($data)
{

        $a1 = explode(' ', $data);
		$a2 = explode(':', $a1[3]);
		$a3 = explode('@', $a1[0]);
		$a4 = explode('!', $a3[0]);
		$a5 = explode(':', $a4[0]);
		$a6 = explode(':', $data);
        $user = $a5[1];
        $inchannel = $a1[2];
$args = NULL; for ($i = 4; $i < count($a1); $i++) {$args .= $a1[$i] . ' ';}
	$all = substr($args, 0, -1);
		if($a1[0] == "PING"){
			fputs($connection, "PONG ".$a1[1]."\n");
		}       
$a13 = substr($a1[3],1);
$log = date("H:i:s ") . $user . ": " . $a13 . " " . $all;
echo $log;
}
$line = fgets($handle);
if($line)
{
if($line[0] == "/")
{
$cmd = explode("/",$line);
unset($cmd[0]);
$cmd = implode("/",$cmd);
$cmd = str_replace("\n","",$cmd);
fputs($connection, "{$cmd}\n");
if($cmd == "quit")
{
die();
}
}
else
{
fputs($connection, "PRIVMSG {$channels} :{$line}");
}
//echo "->  ";
}
usleep(50000);
}

?>
